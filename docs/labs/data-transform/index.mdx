---
title: Data Transforms
---

<head>
    <meta name="title" content="Data Transforms | Redpanda Docs"/>
    <meta name="description" content="Working with data transformation in Redpanda."/>
    <link rel="canonical" href="https://docs.redpanda.com/docs/labs/data-transform/" />
</head>

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import TechPreviewBadge from '../shared/_datatransform_badge.mdx'

<TechPreviewBadge/>

:::caution
Technical Preview features are not supported for production deployments.
:::

Learn about Redpanda Data Transforms and how to create, develop, build, and deploy them to transform records written within Redpanda.

Share your feedback in Redpanda Community Slack ([#wasm-transforms](https://redpandacommunity.slack.com/archives/C05EAMK60QK)) or in a [feedback form](https://forms.gle/mhYbeG3GzhJZ4xtj7). 

## About data transforms

Redpanda Data Transforms provides a framework to create, build and deploy inline data transformations on data written to Redpanda clusters. Users develop custom transform functions, and an asynchronous transforms engine based on WebAssembly (Wasm) runs them. With data transforms, you can enable common streaming tasks such as data filtering, transcoding, normalization, and scrubbing and cleaning.

Users develop data transforms through [`rpk transform`](../data-transform/rpk-transform) commands. Starting with [`rpk transform init`](../data-transform/rpk-transform-init) to initialize a transform project, you edit a transform YAML configuration file (`transform.yaml`) and a transform Golang source file (`transform.go`) with your custom transform functionality. You then build and deploy the transform to a Redpanda cluster. 

## Data transforms tutorial

This tutorial takes you through the steps to setup, create, build, and deploy a Redpanda Data Transforms project in Golang.

### Prerequisites 

1. Install [Golang](https://go.dev/doc/install) (latest version: 1.20).
1. Install [Docker](https://docs.docker.com/get-docker/).

### Install rpk

1. Download the technical preview of `rpk` that supports Data Transforms for your architecture.

  <Tabs groupId="architectures">
  <TabItem value="apple-arm64" label="Apple silicon" default>

  ```bash
  curl -SLO https://dl.redpanda.com/i5iqIdFA2acjP1CQ/redpanda-wasm-transforms-tech-preview/raw/versions/0.0.0-20230809git77afe58/rpk-darwin-arm64.tar.gz
  ```

  </TabItem>
  <TabItem value="apple-amd64" label="Apple x86_64">

  ```bash
  curl -SLO https://dl.redpanda.com/i5iqIdFA2acjP1CQ/redpanda-wasm-transforms-tech-preview/raw/versions/0.0.0-20230809git77afe58/rpk-darwin-amd64.tar.gz
  ```

  </TabItem>
  <TabItem value="linux-amd64" label="Linux x86-64">

  ```bash
  curl -SLO https://dl.redpanda.com/i5iqIdFA2acjP1CQ/redpanda-wasm-transforms-tech-preview/raw/versions/0.0.0-20230809git77afe58/rpk-linux-amd64.tar.gz
  ```

  </TabItem>
  <TabItem value="linux-arm64" label="Linux Arm64">

  ```bash
  curl -SLO https://dl.redpanda.com/i5iqIdFA2acjP1CQ/redpanda-wasm-transforms-tech-preview/raw/versions/0.0.0-20230809git77afe58/rpk-linux-arm64.tar.gz
  ```

  </TabItem>
  </Tabs>

1. Unzip the downloaded bundle to get the custom `rpk` binary.
1. Set the custom `rpk` binary in your `PATH`.

### Set up Redpanda 

1. Start a Redpanda container with the custom `rpk` binary with data transforms enabled.

    ```bash
    rpk container start
    ```

    ```bash-no-copy
    Checking for a local image...
    Creating network redpanda
    Starting cluster...
    Waiting for the cluster to be ready...

    Cluster started!
    NODE-ID  STATUS   KAFKA-ADDRESS    ADMIN-ADDRESS    PROXY-ADDRESS
    0        running  127.0.0.1:56086  127.0.0.1:56085  127.0.0.1:56087

    You can use rpk to interact with this cluster. E.g:

        rpk cluster info -X brokers=127.0.0.1:56086
        rpk cluster health -X admin.hosts=127.0.0.1:56085

    You may also set an environment variable with the comma-separated list of
    broker and admin API addresses:

        export RPK_BROKERS="127.0.0.1:56086"
        export RPK_ADMIN_HOSTS="127.0.0.1:56085"
        rpk cluster info
        rpk cluster health
    ```

    :::important
    - rpk expects Docker to use its default socket. To configure in Docker Desktop, go to **Settings** > **Advanced**, and enable **Allow the default Docker socket to be used**.

    - Set the `REDPANDA_*` environment variables listed in the command's output, as `rpk` will use them when deploying the transform's WebAssembly module for this container.
    :::

1. Create the topics that this tutorial will produce and consume:

    ```bash
    rpk topic create demo-1 demo-2
    ```

### Create data transforms project

1. Create and initialize a data transforms project.

    ```bash
    rpk transform init
    ```

    A successful command generates project files in your current directory:

    ```bash-no-copy
    .
    ├── go.mod
    ├── go.sum
    ├── README.md
    ├── transform.go
    └── transform.yaml
    ```

    `transform.go` contains the transform logic. `transform.yaml` configures the project.

    :::tip tips
    Tips for creating your custom data transform:
    - Initialization steps for a transform can be done in `main`, as it's only run once at the start of the package, or in Golang's standard predefined `init()` function.
    :::

### Build and deploy transform

1. Build the transform into a WebAssembly module.

    ```bash
    rpk transform build
    ```

1. Deploy the WebAssembly module to your cluster.

    ```bash
    rpk transform deploy --input-topic=demo-1 --output-topic=demo-2
    ```

1. To validate your transform is running:

    1. Produce a few records to the `demo-1` topic
    
      ```
      echo "foo\nbar" | rpk topic produce demo-1
      ```

    
    2. Consume from the `demo-2` topic.

      ```
      rpk topic consume demo-2
      ```

      ```text-no-copy
      {
        "topic": "demo-2",
        "value": "foo",
        "timestamp": 1687545891433,
        "partition": 0,
        "offset": 0
      }
      {
        "topic": "demo-2",
        "value": "bar",
        "timestamp": 1687545892434,
        "partition": 0,
        "offset": 1
      }
      ```

## Example transforms

Learn from the source code of some basic transforms. Each example can be copied into the `transform.go` file of the project generated by `rpk transform init`.

### Identity transform

This example transform copies data from an input topic to an output topic.

```go
package main

import (
	"github.com/redpanda-data/redpanda/src/go/transform-sdk"
)

// This example shows the basic usage of the package:
// This is a transform that does nothing but copies the same data to an new
// topic.
func main() {
	// Make sure to register your callback and perform other setup in main
	redpanda.OnRecordWritten(identityTransform)
}

// This will be called for each record in the source topic.
//
// The output records returned will be written to the destination topic.
func identityTransform(e redpanda.WriteEvent) ([]redpanda.Record, error) {
	return []redpanda.Record{e.Record()}, nil
}
```

### Transcoder transform

This example transform converts CSV inputs into JSON outputs.

```go
package main

import (
	"bytes"
	"encoding/csv"
	"encoding/json"
	"errors"
	"io"
	"strconv"

	"github.com/redpanda-data/redpanda/src/go/transform-sdk"
)

// This example shows a transform that converts CSV into JSON.
func main() {
	redpanda.OnRecordWritten(csvToJsonTransform)
}

type Foo struct {
	A string `json:"a"`
	B int    `json:"b"`
}

func csvToJsonTransform(e redpanda.WriteEvent) ([]redpanda.Record, error) {
	// The input data is a CSV (without a header row) that is the structure of:
	// key, a, b
	reader := csv.NewReader(bytes.NewReader(e.Record().Value))
	// Improve performance by reusing the result slice.
	reader.ReuseRecord = true
	output := []redpanda.Record{}
	for {
		row, err := reader.Read()
		if err == io.EOF {
			break
		} else if err != nil {
			return nil, err
		}
		if len(row) != 3 {
			return nil, errors.New("unexpected number of rows")
		}
		// Convert the last column into an int
		b, err := strconv.Atoi(row[2])
		if err != nil {
			return nil, err
		}
		// Marshal our JSON value
		f := Foo{
			A: row[1],
			B: b,
		}
		v, err := json.Marshal(&f)
		if err != nil {
			return nil, err
		}
		// Add our output record using the first column as the key.
		output = append(output, redpanda.Record{
			Key:   []byte(row[0]),
			Value: v,
		})

	}
	return output, nil
}
```

### Validation filter transform

This example transform is a filter that outputs only valid JSON inputs.

```go
import (
	"encoding/json"

	"github.com/redpanda-data/redpanda/src/go/transform-sdk"
)

// This example shows a filter that outputs only valid JSON into the
// output topic.
func main() {
	redpanda.OnRecordWritten(filterValidJson)
}

func filterValidJson(e redpanda.WriteEvent) ([]redpanda.Record, error) {
	v := []redpanda.Record{}
	if json.Valid(e.Record().Value) {
		v = append(v, e.Record())
	}
	return v, nil
}
```

## Update to new release

As new technical previews of Redpanda Data Transforms are released, to update your project and container:

1. Repeat the step to [install `rpk`](#install-rpk). 
1. Purge your running container, then start the newly downloaded container.

  ```bash
  rpk container purge
  rpk container start
  ```


## Data transforms FAQ

### Can I access the local disk?

Not in this version. You may cache things in memory in global variables, but note that the runtime may restart the Wasm module at any point, causing the state to be lost. The `main` function is a good place to initialize any state needed.

### Can I access the network?

Not in this version.

### Can I see `stdout` and `stderr`?

You can from the broker's logs. If you're running the Docker container, you can use `rpk container logs --filter=transform`. Otherwise, it will be sent to the broker's `stderr` output stream.

### Are there known limitations?

- Protobufs are unsupported.
